<!DOCTYPE html>
<html>
<head>
  <title>FURIA - Central de Partidas</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <h1>üêÜ FURIA Esports</h1>

  <% if (username) { %>
    <p>Bem-vindo, <%= username %>!</p>
    <a href="/furia-live">
      <button>üé• Ver partida ao vivo</button>
    </a>
  <% } else { %>
    <a href="/login">Entrar</a> ou <a href="/register">Registrar</a>
  <% } %>

  <% if (data) { %>
    <h2>Lineup Atual</h2>
    <ul>
      <% data.lineup.forEach(p => { %>
        <li><%= p %></li>
      <% }); %>
    </ul>

    <h2>Estat√≠sticas por Mapa</h2>
    <ul>
      <% data.mapStats.forEach(s => { %>
        <li><%= s.map %>: <%= s.winrate %></li>
      <% }); %>
    </ul>

    <h2>√öltimos Resultados</h2>
    <% data.recentMatches.forEach(eventBlock => { %>
      <h3><%= eventBlock.event %></h3>
      <ul>
        <% eventBlock.matches.forEach(match => { %>
          <li>
            <strong>Data:</strong> <%= match.iso_date.toLocaleDateString() %><br>
            <strong>Oponente:</strong> <%= match.opponent %><br>
            <strong>Placar:</strong> <%= match.score %>
          </li>
        <% }) %>
      </ul>
    <% }) %>

    <h2>Pr√≥ximas Partidas</h2>
    <% data.upcomingMatches.forEach(eventBlock => { %>
      <h3><%= eventBlock.event %></h3>
      <ul>
        <% eventBlock.matches.forEach(match => { %>
          <li>
            <strong>Data:</strong> <%= match.iso_date.toLocaleDateString() %><br>
            <strong>Oponente:</strong> <%= match.opponent %><br>
          </li>
        <% }) %>
      </ul>
    <% }) %>

  <% } else { %>
    <p>Nenhuma informa√ß√£o dispon√≠vel no momento.</p>
  <% } %>

  <div id="chat-box">
    <% messages.forEach(msg => { %>
      <div><strong><%= msg.username %>:</strong> <%= msg.text %></div>
    <% }) %>
  </div>

  <form id="chat-form">
    <input id="chat-input" type="text" placeholder="Mensagem..." required />
    <button type="submit">Enviar</button>
  </form>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const username = "<%= username %>";
    const matchId = "general";

    socket.emit('joinRoom', matchId);

    document.querySelector('#chat-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const text = document.querySelector('#chat-input').value;
      if (text.trim()) {
        socket.emit('sendMessage', { username, text, matchId });
        document.querySelector('#chat-input').value = '';
      }
    });

    socket.on('newMessage', msg => {
      const chatBox = document.querySelector('#chat-box');
      chatBox.innerHTML += `<div><strong>${msg.username}:</strong> ${msg.text}</div>`;
    });
  </script>
</body>
</html>
